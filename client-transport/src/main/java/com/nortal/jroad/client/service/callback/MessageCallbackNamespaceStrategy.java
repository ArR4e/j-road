package com.nortal.jroad.client.service.callback;

import com.nortal.jroad.client.service.configuration.BaseXRoadServiceConfiguration;
import com.nortal.jroad.client.util.ServiceVersion;

import java.util.Random;
import jakarta.xml.soap.SOAPEnvelope;
import jakarta.xml.soap.SOAPException;

/**
 * @author Kait Kasak (kait.kasak@nortal.com)
 */
public abstract class MessageCallbackNamespaceStrategy {

	private Random random = new Random(System.currentTimeMillis());

	/**
	 * Unique identifier for service invocation, consisting of numbers and
	 * letters of the Latin alphabet. The identifier is generated by service
	 * invoker, who must guarantee that the identifier is globally unique.
	 */
	protected String generateUniqueMessageId(BaseXRoadServiceConfiguration serviceConfiguration) {
		return Long.toHexString(System.currentTimeMillis()) + serviceConfiguration.getInstitution() + random.nextInt();
	}

	protected String getFullServiceMethodName(BaseXRoadServiceConfiguration serviceConfiguration) {
		StringBuilder sb = new StringBuilder(serviceConfiguration.getDatabase());
		sb.append(".");
		sb.append(serviceConfiguration.getMethod());

		ServiceVersion version = new ServiceVersion(serviceConfiguration.getVersion() == null
																										? "v1"
																										: serviceConfiguration.getVersion());
		if (version.isVersionedMethod()) {
			sb.append(".").append(version.asString());
		}
		return sb.toString();
	}

	public abstract void addNamespaces(SOAPEnvelope env) throws SOAPException;

	public abstract void addXTeeHeaderElements(SOAPEnvelope env, BaseXRoadServiceConfiguration serviceConfiguration)
	        throws SOAPException;

}
